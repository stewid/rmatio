*** mat5.c.orig	2019-11-16 16:05:10.191082842 +0100
--- mat5.c	2019-11-16 16:05:10.210082781 +0100
***************
*** 891,947 ****
      return nBytes;
  }
  
- #if defined(HAVE_ZLIB)
- static size_t
- WriteCompressedEmptyData(mat_t *mat,z_streamp z,int N,
-     enum matio_types data_type)
- {
-     int nBytes = 0, data_size, i;
-     size_t byteswritten = 0;
- 
-     if ( mat == NULL || mat->fp == NULL )
-         return 0;
- 
-     data_size = Mat_SizeOf(data_type);
- 
-     switch ( data_type ) {
-         case MAT_T_DOUBLE:
-         {
-             mat_uint32_t uncomp_buf[32] = {0,};
-             mat_uint32_t comp_buf[32] = {0,};
-             double data_uncomp_buf[4] = {0.0,};
- 
-             nBytes = N*data_size;
-             uncomp_buf[0] = data_type;
-             uncomp_buf[1] = 0;
-             z->next_in  = ZLIB_BYTE_PTR(uncomp_buf);
-             z->avail_in = 8;
-             do {
-                 z->next_out  = ZLIB_BYTE_PTR(comp_buf);
-                 z->avail_out = 32*sizeof(*comp_buf);
-                 deflate(z,Z_NO_FLUSH);
-                 byteswritten += fwrite(comp_buf,1,32*sizeof(*comp_buf)-z->avail_out,(FILE*)mat->fp);
-             } while ( z->avail_out == 0 );
-             for ( i = 0; i < N; i++ ) {
-                 z->next_in  = ZLIB_BYTE_PTR(data_uncomp_buf);
-                 z->avail_in = 8;
-                 do {
-                     z->next_out  = ZLIB_BYTE_PTR(comp_buf);
-                     z->avail_out = 32*sizeof(*comp_buf);
-                     deflate(z,Z_NO_FLUSH);
-                     byteswritten += fwrite(comp_buf,32*sizeof(*comp_buf)-z->avail_out,1,(FILE*)mat->fp);
-                 } while ( z->avail_out == 0 );
-             }
-             break;
-         }
-         default:
-             nBytes = WriteEmptyData(mat,N,data_type);
-     }
- 
-     return byteswritten;
- }
- #endif
- 
  #define WRITE_DATA_SLAB2 \
      do { \
          int i, j; \
--- 891,896 ----
***************
*** 4322,4328 ****
      int rank, size_t nbytes)
  {
      int err = 0;
-     int data_size = Mat_SizeOf(data_type);
      int same_type = 0;
      if (( class_type == MAT_C_DOUBLE && data_type == MAT_T_DOUBLE ) ||
          ( class_type == MAT_C_SINGLE && data_type == MAT_T_SINGLE ) ||
--- 4271,4276 ----
***************
*** 4418,4424 ****
              }
          }
      } else {
!         int nBytes = 0, i, j, N, I = 0;
          int inc[10] = {0,}, cnt[10] = {0,}, dimp[10] = {0,};
  
          switch ( class_type ) {
--- 4366,4372 ----
              }
          }
      } else {
!         int i, j, N, I = 0;
          int inc[10] = {0,}, cnt[10] = {0,}, dimp[10] = {0,};
  
          switch ( class_type ) {
