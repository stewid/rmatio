*** inflate.c.orig	2017-07-20 16:29:32.557310136 +0200
--- inflate.c	2017-07-20 16:29:32.585310461 +0200
***************
*** 29,35 ****
   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   * POSSIBILITY OF SUCH DAMAGE.
   */
! #include <stdlib.h>
  #include "matio_private.h"
  
  #if HAVE_ZLIB
--- 29,46 ----
   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   * POSSIBILITY OF SUCH DAMAGE.
   */
! 
! /*
!  * Changes in the R package rmatio:
!  *
!  * - The io routines have been adopted to use R printing and error routines.
!  *   See the R manual Writing R Extensions
!  *
!  */
! 
! #include <Rdefines.h>
! #define Mat_Critical error
! 
  #include "matio_private.h"
  
  #if HAVE_ZLIB
***************
*** 386,395 ****
          Mat_int32Swap(tag);
          Mat_int32Swap(tag+1);
      }
!     if ( (tag[0] & 0x0000ffff) != MAT_T_INT32 ) {
!         Mat_Critical("InflateDimensions: Reading dimensions expected type MAT_T_INT32");
          return bytesread;
-     }
      rank = tag[1];
      if ( rank % 8 != 0 )
          i = 8-(rank %8);
--- 397,409 ----
          Mat_int32Swap(tag);
          Mat_int32Swap(tag+1);
      }
! 
!     /**
!      *  Stefan Widgren: 2014-04-28
!      *  Removed throwing an error if the data type not equals MAT_T_INT32
!      */
!     if ( (tag[0] & 0x0000ffff) != MAT_T_INT32 )
          return bytesread;
      rank = tag[1];
      if ( rank % 8 != 0 )
          i = 8-(rank %8);
